{% extends "base.html" %}

{% block head_title %}
  This is so Cool!
{% endblock %}

{% block content %}
  <h1>Welcome to Tweetme 2</h1>

  <div id="tweets">
    replace me
  </div>

  <script type="text/javascript">
   const tweetsElements = document.getElementById("tweets")
   // tweetsElements.innerHTML("Loading...")

   function handleDidLike(tweet_id, currentCount) {
     console.log(tweet_id, currentCount)
   }

   function likeButton(tweet){
     return `<button class="btn btn-primary btn-small" onclick="handleDidLike(${tweet.id}, ${tweet.likes})">${tweet.likes} Likes</button>`
   }

   function formatTweet(tweet) {
     return `<div class="mb-4 tweet" id="tweet-${tweet.id}"><p>${tweet.content}</p><div class="btn-group">
${likeButton(tweet)}</div></div>`
   }

   const xhr = new XMLHttpRequest()
   const method = "GET"
   const url = "/tweets"
   const responseType = "json"
   xhr.responseType = responseType
   xhr.open(method, url)
   xhr.onload = function(){
     const serverResponse = xhr.response
     const listItems = serverResponse.response
     let finalTweets = ""
     for (var i=0; i<listItems.length; i++) {
       var tweetObj = listItems[i]
       var currentTweet = formatTweet(tweetObj)
       finalTweets += currentTweet
     }
     tweetsElements.innerHTML = finalTweets
   }
   xhr.send()
  </script>

{% endblock %}
